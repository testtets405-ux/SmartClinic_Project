"""
================================================================================
سكربت إنشاء حساب المسؤول الطارئ (seed_admin.py)
================================================================================
الهدف المنهجي (للطالب):
كيف نستعيد السيطرة على النظام في حالة مسح أو نسيان حساب المدير (Admin) بالخطأ؟
بدلاً من مسح قاعدة البيانات بالكامل وضياع بيانات المرضى باستخدام (seed_db.py)، 
نستخدم هذا السكربت الصغير الآمن. 

ماذا يفعل هذا السكربت؟
يقوم بفتح اتصال بقاعدة البيانات (App Context)، ويبحث داخلياً: هل يوجد مستخدم باسم "admin"؟
1. إذا لم يوجد (كأن يكون تم مسحه بالخطأ)، يقوم بإنشائه فوراً مع كلمة مرور 
   افتراضية (admin) لتمكيننا من الدخول واستعادة السيطرة بأمان.
2. إذا وجده موجوداً، لا يفعل أي شيء لحماية البيانات من التعديل العشوائي.
================================================================================
"""

from app import create_app, db
from models import User

app = create_app()

with app.app_context():
    if not User.query.filter_by(username="admin").first():
        admin = User(username="admin", role="admin")
        admin.set_password("admin")
        db.session.add(admin)
        db.session.commit()
        print("Admin user created successfully.")
    else:
        print("Admin user already exists.")
