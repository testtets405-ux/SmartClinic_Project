{% extends "layout.html" %}
{% block title %}ุงูุนูุงุฏุฉ ุงูุฐููุฉ โ ููุญุฉ ุงูุงุณุชูุจุงู{% endblock %}

{% block content %}
<!-- 
================================================================================
ููุญุฉ ููุธู ุงูุงุณุชูุจุงู (reception.html)
================================================================================
ุงููุฏู ุงููููุฌู (ููุทุงูุจ):
ููุธู ุงูุงุณุชูุจุงู ูู (ุงููุงูุณุชุฑู) ุงูุฎุงุต ุจุงูุนูุงุฏุฉุ ููุฐูู ูุญุชุงุฌ ูุงุฌูุฉ ุชุฌูุน ุจูู:
1. ุฅุฏุฎุงู ูุฑูุถ ุฌุฏูุฏ (ูู ุญุงู ูู ูุณุชุฎุฏู ุงููุฑูุถ ุดุงุดุฉ Kiosk).
2. ูุฑุงูุจุฉ ุงูุทุงุจูุฑ ุงูุญุงูู ูุงูุชุญูู ุจููุน ุงูุญุฌุฒ (ุชุบููุฑ ููุน ุงูุญุฌุฒ ูุทูุงุฑุฆ ุฅุฐุง ุณุงุกุช ุญุงูุฉ ุงููุฑูุถ).

ุชุนุชูุฏ ูุฐู ุงูุตูุญุฉ ุนูู ูุญุฑู ููุงูุจ Jinja2 ูู ููุฏ `{ % for p in patients % }`
ููููู ุงูููุงุณู ุจุงููุฑูุฑ ุนูู ุฌููุน ุงููุฑุถูุ ูุทุจุงุนุฉ ุจูุงูุงุชูู ูู (Rows) ูู ุฌุฏูู HTMLุ 
ุจุฏูุงู ูู ูุชุงุจุฉ ุงูููุฏ ูุฏููุงู ูุฆุงุช ุงููุฑุงุช!
================================================================================
-->
<h3 class="mb-4 animate-fade-in fw-bold">
  <i class="bi bi-people-fill text-primary me-2"></i>ููุญุฉ ุงูุงุณุชูุจุงู ุงูุฐููุฉ
</h3>

<div class="row g-4">
  <div class="col-lg-4">
    <div class="card p-4 h-100">
      <h5 class="mb-3 fw-bold">
        <i class="bi bi-person-plus-fill text-primary me-2"></i>ุชุณุฌูู ูุฑูุถ ุฌุฏูุฏ
      </h5>
      <form method="POST" action="{{ url_for('reception') }}">
        <div class="mb-3">
          <label for="name" class="form-label fw-bold">ุงูุงุณู ุงูุซูุงุซู</label>
          <input type="text" class="form-control" id="name" name="name" required placeholder="ุฃุฏุฎู ุงุณู ุงููุฑูุถ">
        </div>
        <div class="mb-3">
          <label for="age" class="form-label fw-bold">ุงูุนูุฑ</label>
          <input type="number" class="form-control" id="age" name="age" min="0" max="150" required
            placeholder="ูุซุงู: 35">
        </div>
        <div class="mb-3">
          <label for="gender" class="form-label fw-bold">ุงูููุน</label>
          <select class="form-select" id="gender" name="gender" required>
            <option value="male">ุฐูุฑ</option>
            <option value="female">ุฃูุซู</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="appointment_type" class="form-label fw-bold">ููุน ุงูุฒูุงุฑุฉ</label>
          <select class="form-select" id="appointment_type" name="appointment_type" required>
            <option value="checkup">๐ข ูุดู ุนุงุฏู (Checkup)</option>
            <option value="follow_up">๐ก ูุชุงุจุนุฉ (Follow-Up)</option>
            <option value="emergency">๐ด ุทูุงุฑุฆ / ุญุงูุฉ ุญุฑุฌุฉ (Emergency)</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary w-100 mt-2 fw-bold">
          <i class="bi bi-check-circle me-1"></i>ุชุณุฌูู ูุญุณุงุจ ุงูุฃููููุฉ
        </button>
      </form>
    </div>
  </div>

  <div class="col-lg-8">
    <div class="card p-3 h-100">
      <h5 class="mb-3 fw-bold">
        <i class="bi bi-list-ol text-success me-2"></i>ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุญุงููุฉ
      </h5>
      <div class="table-responsive">
        <table class="table table-queue table-hover mb-0 text-center">
          <thead>
            <tr>
              <th>#</th>
              <th>ุงูุงุณู</th>
              <th>ุงูุนูุฑ</th>
              <th>ููุน ุงูุฒูุงุฑุฉ</th>
              <th>ููุงุท ุงูุฃููููุฉ</th>
              <th>ุฒูู ุงูุงูุชุธุงุฑ ุงููุชููุน</th>
              <th>ุงูุญุงูุฉ</th>
            </tr>
          </thead>
          <tbody>
            {% if patients %}
            {% for p in patients %}
            <tr>
              <td class="fw-bold">{{ loop.index }}</td>
              <td>{{ p.name }}</td>
              <td>{{ p.age }}</td>
              <td>
                <span class="badge
                  {% if p.appointment_type == 'emergency' %}badge-emergency
                  {% elif p.appointment_type == 'follow_up' %}badge-follow-up
                  {% else %}badge-checkup{% endif %}">
                  {% if p.appointment_type == 'emergency' %}ุทูุงุฑุฆ
                  {% elif p.appointment_type == 'follow_up' %}ูุชุงุจุนุฉ
                  {% else %}ูุดู ุนุงุฏู{% endif %}
                </span>
              </td>
              <td><strong>{{ p.priority_score }}</strong></td>
              <td>
                {% set w = wait_times.get(p.id, 0) %}
                {% if w <= 0 %} ุงูุขู {% else %} ุญูุงูู {{ w }} ุฏูููุฉ {% endif %} </td>
              <td>
                {% if p.status == 'in_progress' %}
                <i class="bi bi-arrow-left-circle-fill status-in-progress me-1"></i>ุจุงูุนูุงุฏุฉ
                {% elif p.status == 'done' %}
                <i class="bi bi-check-circle-fill status-done me-1"></i>ุชู
                {% else %}
                <i class="bi bi-clock-fill status-waiting me-1"></i>ุงูุชุธุงุฑ
                {% endif %}
              </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="7" class="text-center text-muted py-4">
                <i class="bi bi-emoji-smile me-1"></i>ูุง ููุฌุฏ ูุฑุถู ุญุงููุงู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Upcoming Appointments Row -->
<div class="row mt-4 mb-5">
  <div class="col-12">
    <div class="card p-3 shadow-sm border-0">
      <h5 class="mb-3 fw-bold text-secondary">
        <i class="bi bi-calendar-event me-2"></i>ุงูููุงุนูุฏ ุงููุณุชูุจููุฉ (ููุญุฌุฒ ุงููุณุจู)
      </h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle text-center mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>ุงูุงุณู</th>
              <th>ุชุงุฑูุฎ ุงูููุนุฏ</th>
              <th>ููุน ุงูุฒูุงุฑุฉ</th>
              <th>ุงูุฅุฌุฑุงุก</th>
            </tr>
          </thead>
          <tbody>
            {% if scheduled %}
            {% for s in scheduled %}
            <tr>
              <td class="fw-bold">{{ loop.index }}</td>
              <td>{{ s.name }}</td>
              <td dir="ltr" class="text-primary fw-bold">{{ s.check_in_time | iraqtime('%Y-%m-%d') }}</td>
              <td>
                <span class="badge
                  {% if s.appointment_type == 'emergency' %}bg-danger
                  {% elif s.appointment_type == 'follow_up' %}bg-warning text-dark
                  {% else %}bg-success{% endif %}">
                  {% if s.appointment_type == 'emergency' %}ุทูุงุฑุฆ
                  {% elif s.appointment_type == 'follow_up' %}ูุชุงุจุนุฉ
                  {% else %}ูุดู ุนุงุฏู{% endif %}
                </span>
              </td>
              <td>
                <form method="POST" action="{{ url_for('reception_checkin', patient_id=s.id) }}" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-outline-primary fw-bold"
                    title="ุชุณุฌูู ุงูุญุถูุฑ ูุฅุฏุฎุงู ููุงุฆูุฉ ุงูุงูุชุธุงุฑ">
                    <i class="bi bi-box-arrow-in-right me-1"></i>ุชุณุฌูู ุญุถูุฑ (Check-in)
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted py-4">
                <i class="bi bi-calendar-x me-1"></i>ูุง ููุฌุฏ ููุงุนูุฏ ูุณุชูุจููุฉ ูุณุฌูุฉ.
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}